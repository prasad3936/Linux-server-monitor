<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>System Stats Dashboard</title>
    <link
      rel="stylesheet"
      type="text/css"
      href="{{ url_for('static', filename='styles.css') }}"
    />
    <script src="https://cdn.socket.io/4.0.0/socket.io.min.js"></script>
  </head>
  <body>
    <div class="container">
      <!-- System Info Section -->
      <div class="system-info">
        <h1>System Information</h1>
        <div class="info">
          <p>OS Version: <span id="os-version"></span></p>
          <p>OS Type: <span id="os-type"></span></p>
          <p>Uptime: <span id="uptime-str"></span></p>

          <!-- CPU Usage Progress Bar -->
          <div class="progress-bar-container">
            <p>CPU Usage: <span id="cpu-percent"></span>%</p>
            <div class="progress-bar">
              <div
                class="progress-bar-fill cpu-bar"
                id="cpu-bar"
                style="width: 0%"
              ></div>
            </div>
          </div>

          <!-- Memory Usage Progress Bar -->
          <div class="progress-bar-container">
            <p>Memory Usage: <span id="memory-percent"></span>%</p>
            <div class="progress-bar">
              <div
                class="progress-bar-fill memory-bar"
                id="memory-bar"
                style="width: 0%"
              ></div>
            </div>
          </div>
        </div>
      </div>

      <!-- Container Info Section -->
      <div class="container-info">
        <h2>Containers</h2>
        <table>
          <tr>
            <th>Container Name</th>
            <th>Container ID</th>
            <th>Status</th>
            <th>CPU Usage</th>
            <th>Memory Usage</th>
            <th>Memory Limit</th>
          </tr>
          <tbody id="containers-info"></tbody>
        </table>
      </div>
    </div>

    <script>
      const socket = io();

      socket.on("update", function (data) {
        document.getElementById("os-version").innerText = data.os_version;
        document.getElementById("os-type").innerText = data.os_type;
        document.getElementById("uptime-str").innerText = data.uptime_str;
        document.getElementById("cpu-percent").innerText = data.cpu_percent;
        document.getElementById("cpu-bar").style.width = data.cpu_percent + "%";

        const memoryPercent = data.memory_percent;
        document.getElementById("memory-percent").innerText = memoryPercent;
        document.getElementById("memory-bar").style.width = memoryPercent + "%";

        const containersInfo = data.containers_info
          .map(
            (container) => `
            <tr>
                <td>${container.name}</td>
                <td>${container.id}</td>
                <td class="${
                  container.status === "running"
                    ? "status-running"
                    : "status-stopped"
                }">${container.status}</td>
                <td>${container.cpu_usage}</td>
                <td>${container.memory_usage}</td>
                <td>${container.memory_limit}</td>
            </tr>
        `
          )
          .join("");

        document.getElementById("containers-info").innerHTML = containersInfo;
      });
    </script>
  </body>
</html>
